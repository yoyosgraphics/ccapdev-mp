<!-- register.hbs file -->
{{> navigation}}
<div class="register-container">
    <div class="image-section"></div>
    <div class="reg-section">
        <div class="form-container">
            <h2>Register</h2>
            
            {{#if alerts.length}}
            <div class="alerts">
                {{#each alerts}}
                <div class="alert alert-{{this.type}}">
                    {{this.message}}
                </div>
                {{/each}}
            </div>
            {{/if}}
            
            {{#if showPage}}
            <form action="/users/register-step-one" method="POST" id="register-form-step1">
                <div id="reg-page-1">
                    <input type="email" name="email_address" placeholder="Email Address*" value="{{formData.email_address}}" required>
                    <div class="name-group">
                        <input type="text" name="first_name" placeholder="First Name*" value="{{formData.first_name}}" required>
                        <input type="text" name="last_name" placeholder="Last Name*" value="{{formData.last_name}}" required>
                    </div>
                    <input type="text" name="username" placeholder="Username*" value="{{formData.username}}" required>
                    <input type="password" name="password" placeholder="Password*" required>
                    <input type="password" name="confirm_password" placeholder="Confirm Password*" required>
                    
                    <div class="reg-container">
                        <button type="submit" class="next-btn">Next</button>
                    </div>
                </div>
            </form>
            {{/if}}
            
            {{#if showPageTwo}}
            <form action="/users/register" method="POST" id="register-form-step2" enctype="multipart/form-data">
                <!-- Hidden fields to carry over from step 1 -->
                <input type="hidden" name="email_address" value="{{formData.email_address}}">
                <input type="hidden" name="first_name" value="{{formData.first_name}}">
                <input type="hidden" name="last_name" value="{{formData.last_name}}">
                <input type="hidden" name="username" value="{{formData.username}}">
                <input type="hidden" name="password" value="{{formData.password}}">
                <input type="hidden" name="confirm_password" value="{{formData.confirm_password}}">
                
                <div id="reg-page-2">
                    <div class="upload-pic-container">
                        <div class="upload-container">
                            <label class="upload-box">
                                <input type="file" id="file-input" name="picture_address" accept="image/*">
                                <div class="upload-placeholder">+</div>
                                <img id="profile-image" src="" style="display: none;">
                            </label>
                            <div class="upload-label">
                                <span>Upload Your Profile Picture</span>
                                <span class="max-size">(Max: 50 MB)</span>
                            </div>
                        </div>
                    </div>

                    <div class="bio-box">
                        <textarea id="bio" name="biography" maxlength="1500" placeholder="Biography">{{formData.biography}}</textarea>
                        <span class="char-counter" id="char-counter">0/1500</span>
                    </div>

                    <div class="buttons">
                        <button type="button" class="prev-btn" onclick="window.location.href='/register'">Previous</button>
                        <button type="submit" class="signup-btn">Sign Up</button>
                    </div>
                </div>
            </form>
            {{/if}}
        </div>
    </div>
</div>

<script>
// JavaScript to handle image preview and character count
document.addEventListener('DOMContentLoaded', function() {
    // Image preview functionality
    const fileInput = document.getElementById('file-input');
    const profileImage = document.getElementById('profile-image');
    const uploadPlaceholder = document.querySelector('.upload-placeholder');
    
    if (fileInput) {
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    profileImage.src = e.target.result;
                    profileImage.style.display = 'block';
                    if (uploadPlaceholder) {
                        uploadPlaceholder.style.display = 'none';
                    }
                };
                
                reader.readAsDataURL(this.files[0]);
            }
        });
    }
    
    // Character counter for biography
    const bioTextarea = document.getElementById('bio');
    const charCounter = document.getElementById('char-counter');
    
    if (bioTextarea && charCounter) {
        bioTextarea.addEventListener('input', function() {
            const currentLength = this.value.length;
            charCounter.textContent = currentLength + '/1500';
        });
        
        // Initialize counter
        if (bioTextarea.value) {
            charCounter.textContent = bioTextarea.value.length + '/1500';
        }
    }
});
</script>
{{> footer}}